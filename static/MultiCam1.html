<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="CCTVLIVE is a new age video security or business solution to keep track of whats going on at home or at local business place for Free. No signups, no downloads completely secure and real time." />
    <meta name="keywords" content="home security, cctv,  cctv solutions, security cameras, online security camera, cctv on mobile,  real time video, surveillance camera, cheap cctv, surveillance cctv, online cctv, security solution" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="CCTV Live" />

    <title>Free CCTV Security Solutions</title>
    
      
    </head>
    <body>
<h1>Broadcast Multiple-Cameras using <a href="http://www.rtcmulticonnection.org/">RTCMultiConnection.js</a></h1>
<hr />

<div id="buttons-container" >
	<input type="text" id="broadcast-name" class="form-control" placeholder="Room name" />
    <button id="broadcast-all-cameras" disabled>Broadcast All Cameras</button>
</div>

<table style="width: 100%;" id="rooms-list"></table>

    
<div>
   This demo is using <a href="http://www.rtcmulticonnection.org/">RTCMultiConnection.js</a>. 
    This demo enumerates over all available video devices, and appends &lt;button&gt; for each device.
    You can click any button to capture relevant webcam.
    Then you can click "Broadcast All Cameras" button to broadcast your "multiple-cameras" over multiple users.
</div>
<hr />

<div id="videos-container"></div>

<script src="//cdn.webrtc-experiment.com/RTCMultiConnection-v2.2.1.js"> </script>
<script>
var connection = new RTCMultiConnection();

// connection.getExternalIceServers = false; // optional--remove it.
// connection.iceServers.length = 1;         // optional--remove it.

connection.dontCaptureUserMedia = true;

// Parent <div> for videos
connection.body = document.getElementById('videos-container');

connection.session = {
    audio: true,
    video: true
	
};

connection.direction = 'one-way';

connection.sdpConstraints.mandatory = {
    OfferToReceiveAudio: true,
    OfferToReceiveVideo: true
};

var buttonsContainer = document.getElementById('buttons-container');
// DetectRTC.load --- to make sure all devices are captured
// connection.enumerateDevices --- to get list of all captured devices
connection.DetectRTC.load(function() {
    connection.enumerateDevices(function(devices) {
        // iterate over devices-array
        devices.forEach(function(device) {
            // skip audio devices
            if (device.kind.indexOf('audio') != -1) return;
			 for (var i = 0; i < device.length; i++) {
             device[i].label = "Cam_" + i;
			 }
            var button = document.createElement('button');
            button.id = device.deviceId;
           // button.innerHTML = device.label || device.deviceId;
			 button.innerHTML = device.label || "Cam_" + i;
            button.onclick = function() {
                this.disabled = true;

                connection.selectDevices(this.id);
                connection.dontCaptureUserMedia = false;
				
                connection.captureUserMedia(function(stream) {
                connection.attachStreams.push(stream);
				connection.dontCaptureUserMedia = true;
                    
                    if(document.getElementById('broadcast-all-cameras').disabled == true) {
                        document.getElementById('broadcast-all-cameras').disabled = false;
                        document.getElementById('broadcast-all-cameras').style.background = '-webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(0.05, rgb(143, 231, 253)), to(rgb(255, 255, 255)))';
                    }
                });
            };
            buttonsContainer.appendChild(button);
        });
    });
});
				var sessions = { };
                connection.onNewSession = function(session) {
                    if (sessions[session.sessionid]) return;
                    sessions[session.sessionid] = session;

                    var tr = document.createElement('tr');
                    tr.innerHTML = '<td><strong>' + session.sessionid + '</strong> is sharing his webcam in one-way direction!</td>' +
                        '<td><button class="join">View His Webcam</button></td>';
						if(tr != null)
							{
							document.getElementById('broadcast-all-cameras').disabled = true;
						    document.getElementById('broadcast-name').disabled = true;
							document.getElementById('buttons-container').innerHTML = ' ';
							
							
							}
						
						
						 roomsList.insertBefore(tr, roomsList.firstChild);
						
							

                    var joinRoomButton = tr.querySelector('.join');
                    joinRoomButton.setAttribute('data-sessionid', session.sessionid);
                    joinRoomButton.onclick = function() {
                        this.disabled = true;

                        var sessionid = this.getAttribute('data-sessionid');
                        session = sessions[sessionid];

                        if (!session) throw 'No such session exists.';

                        connection.join(session);
                    };
                };
				var roomsList = document.getElementById('rooms-list');
// signaling implementation
// https://github.com/muaz-khan/WebRTC-Experiment/tree/master/websocket-over-nodejs
var SIGNALING_SERVER = 'wss://wsnodejs.nodejitsu.com:443';
connection.openSignalingChannel = function(config) {
    config.channel = config.channel || this.channel;
    var websocket = new WebSocket(SIGNALING_SERVER);
    websocket.channel = config.channel;
    websocket.onopen = function() {
        websocket.push(JSON.stringify({
            open: true,
            channel: config.channel
        }));
        if (config.callback)
            config.callback(websocket);
    };
    websocket.onmessage = function(event) {
        config.onmessage(JSON.parse(event.data));
    };
    websocket.push = websocket.send;
    websocket.send = function(data) {
        websocket.push(JSON.stringify({
            data: data,
            channel: config.channel
        }));
    };
};

connection.connect();

document.getElementById('broadcast-all-cameras').onclick = function() {
    this.disabled = true;
    this.style.background = 'rgba(216, 205, 205, 0.2)';
    
    connection.open(document.getElementById('broadcast-name').value || 'Anonymous');
};
</script>
            
<style>
video {width: 30%}
button {
    font-family: Myriad, Arial, Verdana;
    font-weight: normal;
    border-top-left-radius: 3px;
    border-top-right-radius: 3px;
    border-bottom-right-radius: 3px;
    border-bottom-left-radius: 3px;
    padding: 4px 12px;
    text-decoration: none;
    color: rgb(27, 26, 26);
    display: inline-block;
    box-shadow: rgb(255, 255, 255) 1px 1px 0px 0px inset;
    text-shadow: none;
    background: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(0.05, rgb(241, 241, 241)), to(rgb(230, 230, 230)));
    font-size: 20px;
    border: 1px solid red;
}
button[disabled] {
    background: rgba(216, 205, 205, 0.2);
    border: 1px solid rgb(233, 224, 224);
}
blockquote {
    font-size: 20px;
    color: rgb(172, 10, 10);
    border: 1px solid rgb(172, 10, 10);
    padding: 5px 10px;
    border-radius: 5px;
    margin: 9px 10px;
}
.commented-container{
				}
</style>

</body>
</html>